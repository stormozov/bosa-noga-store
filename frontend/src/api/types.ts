/**
 * Тип, представляющий поддерживаемые HTTP-методы.
 *
 * Используется для строгой типизации методов запросов в API.
 */
export type HttpMethod = "GET" | "POST";

/**
 * Интерфейс, определяющий опций для API-запросов.
 *
 * Определяет дополнительные параметры, которые могут быть переданы
 * при вызове функций работы с API.
 */
export interface IApiOptions {
	/**
	 * Заголовки HTTP-запроса.
	 *
	 * @default undefined
	 *
	 * @example
	 * { "Content-Type": "application/json", "Authorization": "Bearer token" }
	 */
	headers?: HeadersInit;

	/**
	 * Таймаут запроса в миллисекундах.
	 *
	 * Определяет максимальное время ожидания ответа от сервера.
	 * Если ответ не получен за указанное время, запрос прерывается.
	 *
	 * @default 5000
	 *
	 * @example 10_000
	 */
	timeout?: number;

	/**
	 * Сигнал, используемый для прерывания запроса.
	 *
	 * @default undefined
	 */
	signal?: AbortSignal;
}

/**
 * Интерфейс конфигурации запроса, расширяющий стандартный {@link RequestInit}.
 */
export interface IFetchConfig extends RequestInit {
	/**
	 * Таймаут запроса в миллисекундах.
	 *
	 * Если указан, запрос будет прерван, если не завершится в течение
	 * заданного времени. Используется для предотвращения зависаний.
	 *
	 * @default undefined
	 *
	 * @example 15_000
	 */
	timeout?: number;
}

// =============================================================================
// --- ТИПЫ И ИНТЕРФЕЙСЫ, СВЯЗАННЫЕ С КАСТОМНЫМИ ХУКАМИ РАБОТЫ С API

/**
 * Интерфейс возвращаемого значения хука {@link useApiGet}.
 *
 * Описывает структуру объекта, возвращаемого кастомным хуком для управления
 * состоянием GET-запроса к API.
 */
export interface IUseGetReturns<T> {
	/**
	 * Данные, полученные от API.
	 *
	 * Содержит результат запроса строго типизированного по `T`.
	 * Изначально `null`, до завершения первого запроса.
	 *
	 * @example
	 * [{ id: 1, name: "Товар" }, { id: 2, name: "Товар 2" }]
	 */
	data: T | null;

	/**
	 * Флаг состояния загрузки.
	 *
	 * Равен `true`, пока выполняется запрос. Используется для отображения
	 * индикатора загрузки в интерфейсе.
	 *
	 * @default true
	 */
	loading: boolean;

	/**
	 * Объект ошибки, если запрос завершился неудачно.
	 *
	 * Содержит экземпляр `Error` при возникновении проблемы (сетевая ошибка,
	 * неверный ответ и т.д.). В противном случае — `null`.
	 *
	 * @default null
	 */
	error: Error | null;

	/**
	 * Функция для повторного выполнения запроса.
	 *
	 * Позволяет принудительно обновить данные, например, при действиях
	 * пользователя (кнопка "Обновить") или изменении зависимости, не влияя
	 * на `url` или `options`.
	 */
	refetch: () => void;
}

/**
 * Тип функции для выполнения HTTP-запроса.
 *
 * @template T - Тип ожидаемого ответа от сервера.
 *
 * @param url - URL-адрес, по которому будет выполнен запрос.
 * @param body - Тело запроса, может быть любого типа (обычно объект, строка
 * или `null`).
 * @param options - Необязательные параметры запроса, такие как заголовки,
 * метод, таймаут и т.д.
 *
 * @returns Промис, который разрешается с данными типа `T` в случае
 * успешного ответа.
 *
 * @example
 * const fetchData: ExecuteFuncType<UserData> = async (url, body, options) => {
 *   const response = await fetch(url, { ...options, body: JSON.stringify(body) });
 *   return response.json() as T;
 * };
 */
export type ExecuteFuncType<T> = (
	url: string,
	body: unknown,
	options?: IApiOptions,
) => Promise<T>;

/**
 * Интерфейс, описывающий возвращаемое значение хука {@link useApiPost}.
 *
 * @template T - Тип данных, которые будут получены в результате выполнения
 * запроса.
 */
export interface IUsePostReturns<T> {
	/**
	 * Флаг состояния загрузки.
	 *
	 * Принимает значение `true`, если запрос в процессе выполнения,
	 * и `false` — если завершён.
	 */
	loading: boolean;

	/**
	 * Объект ошибки, возникшей при выполнении запроса.
	 *
	 * Если ошибки нет — значение `null`.
	 */
	error: Error | null;

	/**
	 * Функция для выполнения HTTP-запроса.
	 *
	 * Может быть вызвана отдельно для отправки данных на сервер.
	 * Принимает URL, тело запроса и опциональные параметры.
	 *
	 * @see {@link ExecuteFuncType}
	 */
	execute: ExecuteFuncType<T>;
}

/**
 * Интерфейс состояния кастомного хука {@link usePaginatedApi}.
 *
 * Содержит текущие данные и мета-информацию о состоянии загрузки, ошибке
 * и наличии следующих страниц.
 *
 * @template T - Тип элементов, возвращаемых в массиве данных.
 */
export interface IPaginatedApiState<T> {
	/**
	 * Массив данных, полученных с сервера.
	 *
	 * Изначально может быть пустым.
	 */
	data: T[];

	/**
	 * Флаг, указывающий, выполняется ли первоначальная загрузка данных.
	 *
	 * Используется для отображения прелоадера.
	 */
	loadingInitial: boolean;

	/**
	 * Флаг, указывающий, загружаются ли дополнительные данные.
	 */
	loadingMore: boolean;

	/**
	 * Объект ошибки.
	 */
	error: Error | null;

	/**
	 * Флаг, показывающий, есть ли ещё данные на следующих страницах.
	 *
	 * Если `false`, дальнейшая подгрузка не требуется.
	 */
	hasMore: boolean;

	/**
	 * Текущее смещение (offset), используемое для запроса следующей порции данных.
	 *
	 * Соответствует количеству уже загруженных элементов.
	 */
	offset: number;
}

/**
 * Интерфейс действий (actions), которые может выполнять кастомный хук
 * {@link usePaginatedApi}.
 *
 * Содержит функции для управления загрузкой данных.
 */
export interface IPaginatedApiActions {
	/**
	 * Перезагружает данные с заданными параметрами.
	 *
	 * @param params - Дополнительные параметры фильтрации
	 * (например, `categoryId`, `search` и т.д.).
	 * @param isInitial - Указывает, является ли загрузка инициализирующей.
	 * По умолчанию `true`.
	 * @param initialOffset - Начальное смещение. По умолчанию `0`.
	 *
	 * @returns Промис, который разрешается после завершения загрузки.
	 */
	refetch: (
		params?: Record<string, unknown>,
		isInitial?: boolean,
		initialOffset?: number,
	) => Promise<void>;

	/**
	 * Загружает следующую порцию данных, увеличивая `offset` на размер страницы.
	 *
	 * @param params - Параметры, передаваемые при подгрузке
	 * (например, для сохранения фильтров).
	 * @returns Промис, который разрешается после загрузки дополнительных данных.
	 */
	loadMore: (params?: Record<string, unknown>) => Promise<void>;

	/**
	 * Сбрасывает состояние хука до начального
	 * (очищает данные, сбрасывает offset и т.д.).
	 */
	reset: () => void;
}

/**
 * Основной интерфейс результата, возвращаемый кастомным хуком
 * {@link usePaginatedApi}.
 *
 * Объединяет состояние и действия в единую структуру.
 *
 * @template T - Тип элементов в массиве данных.
 */
export interface IPaginatedApiResult<T> {
	/**
	 * Объект состояния, содержащий данные и флаги загрузки.
	 */
	state: IPaginatedApiState<T>;

	/**
	 * Объект действий, позволяющий управлять загрузкой данных.
	 */
	actions: IPaginatedApiActions;
}

/**
 * Тип, представляющий произвольные параметры запроса к API.
 *
 * Используется для передачи фильтров, поисковых строк, сортировок и других
 * опциональных данных в виде ключ-значение.
 *
 * Пример: `{ search: "носки", categoryId: 4, sort: "price" }`
 */
export type ApiParams = Record<string, unknown>;

/**
 * Интерфейс, описывающий параметры для пагинированного API-запроса.
 *
 * Определяет конфигурацию, необходимую для хуков и утилит, управляющих
 * постраничной загрузкой данных с сервера.
 */
export interface IPaginatedApiParams {
	/**
	 * Базовый URL API-эндпоинта, к которому будут добавлены параметры пагинации
	 * и фильтрации.
	 *
	 * @example
	 * "http://localhost:3000/api/items"
	 */
	baseUrl: string;

	/**
	 * Дополнительные параметры фильтрации и поиска.
	 * Передаются в виде строки запроса.
	 *
	 * Необязательный параметр. Если не указан — запрос выполняется без фильтров.
	 *
	 * @default {}
	 *
	 * @example
	 * {
	 *   categoryId: 3,
	 *   search: "платье",
	 *   inStock: true
	 * }
	 */
	params?: ApiParams;

	/**
	 * Количество элементов на одной странице.
	 *
	 * Необязательный параметр. Используется для расчёта `offset` и определения
	 * наличия следующей страницы (`hasMore`).
	 *
	 * @default 6
	 */
	itemsPerPage?: number;

	/**
	 * Дополнительные опции для выполнения HTTP-запроса.
	 * Могут включать заголовки, таймаут, сигнал отмены и т.д.
	 *
	 * Необязательный параметр.
	 *
	 * @see IApiOptions
	 */
	options?: IApiOptions;
}
